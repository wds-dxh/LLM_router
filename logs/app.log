2024-12-17 21:07:54,859 - app.middlewares.auth_middleware - ERROR - Authentication failed: Forbidden: Invalid or inactive API Key
2024-12-17 21:08:10,245 - app.middlewares.auth_middleware - ERROR - Authentication failed: Forbidden: Invalid or inactive API Key
2024-12-17 21:11:18,107 - app.middlewares.auth_middleware - ERROR - Authentication failed: Forbidden: Inactive API Key
2024-12-17 21:12:30,874 - app.middlewares.auth_middleware - ERROR - Authentication failed: Forbidden: Inactive API Key
2024-12-17 21:16:44,099 - app.middlewares.auth_middleware - ERROR - Authentication failed: Forbidden: Inactive API Key
2024-12-17 21:19:55,522 - app.middlewares.auth_middleware - ERROR - device_id: device_001, api_key: 1, status: sk-test-123456
2024-12-17 21:19:55,522 - app.middlewares.auth_middleware - ERROR - Authentication failed: Forbidden: Inactive API Key
2024-12-17 21:22:25,588 - app.middlewares.auth_middleware - ERROR - Unexpected error during authentication: tuple indices must be integers or slices, not str
2024-12-17 21:22:51,579 - app.middlewares.auth_middleware - ERROR - Unexpected error during authentication: tuple indices must be integers or slices, not str
2024-12-17 21:27:00,130 - app.middlewares.auth_middleware - ERROR - device_id: device_001, api_key: sk-test-123456, status: active
2024-12-17 21:27:00,131 - app.middlewares.auth_middleware - INFO - Authentication successful for device_id: device_001
2024-12-17 21:27:00,131 - app.middlewares.logging_middleware - INFO - Incoming request: GET /test from 127.0.0.1
2024-12-17 21:27:00,131 - app.middlewares.logging_middleware - INFO - Response: 200 GET /test processed in 0.00s
2024-12-17 21:28:34,386 - app.middlewares.auth_middleware - INFO - Authentication successful for device_id: device_001
2024-12-17 21:28:34,387 - app.middlewares.logging_middleware - INFO - Incoming request: GET /test/read from 127.0.0.1
2024-12-17 21:28:34,387 - app.utils.permission_checker - ERROR - Permission denied: 'read' required but not granted
2024-12-17 21:28:34,387 - app.middlewares.logging_middleware - INFO - Response: 403 GET /test/read processed in 0.00s
2024-12-17 21:29:59,416 - app.middlewares.auth_middleware - INFO - Authentication successful for device_id: device_001
2024-12-17 21:29:59,416 - app.middlewares.logging_middleware - INFO - Incoming request: GET /test/llm from 127.0.0.1
2024-12-17 21:29:59,416 - app.utils.permission_checker - ERROR - Permission denied: 'llm.chat' required but not granted
2024-12-17 21:29:59,417 - app.middlewares.logging_middleware - INFO - Response: 403 GET /test/llm processed in 0.00s
2024-12-17 21:30:58,571 - app.middlewares.auth_middleware - INFO - Authentication successful for device_id: device_001
2024-12-17 21:30:58,571 - app.middlewares.logging_middleware - INFO - Incoming request: GET /test/llm from 127.0.0.1
2024-12-17 21:30:58,571 - app.utils.permission_checker - ERROR - Permission denied: 'llm.chat' required but not granted
2024-12-17 21:30:58,571 - app.middlewares.logging_middleware - INFO - Response: 403 GET /test/llm processed in 0.00s
2024-12-17 21:31:14,969 - app.middlewares.auth_middleware - INFO - Authentication successful for device_id: device_001
2024-12-17 21:31:14,969 - app.middlewares.logging_middleware - INFO - Incoming request: GET /test/llm from 127.0.0.1
2024-12-17 21:31:14,969 - app.utils.permission_checker - ERROR - Permission denied: 'llm.chat' required but not granted
2024-12-17 21:31:14,969 - app.middlewares.logging_middleware - INFO - Response: 403 GET /test/llm processed in 0.00s
2024-12-17 21:31:54,760 - app.middlewares.auth_middleware - INFO - Authentication successful for device_id: device_001
2024-12-17 21:31:54,761 - app.middlewares.logging_middleware - INFO - Incoming request: GET /test/llm from 127.0.0.1
2024-12-17 21:31:54,761 - app.utils.permission_checker - INFO - Permission 'llm.chat' granted
2024-12-17 21:31:54,761 - app.middlewares.logging_middleware - INFO - Response: 200 GET /test/llm processed in 0.00s
2024-12-17 21:32:14,578 - app.middlewares.auth_middleware - INFO - Authentication successful for device_id: device_001
2024-12-17 21:32:14,578 - app.middlewares.logging_middleware - INFO - Incoming request: GET /test/llm from 127.0.0.1
2024-12-17 21:32:14,579 - app.middlewares.logging_middleware - ERROR - Exception: name 'permissions' is not defined - GET /test/llm processed in 0.00s
2024-12-17 21:32:30,153 - app.middlewares.auth_middleware - INFO - Authentication successful for device_id: device_001
2024-12-17 21:32:30,153 - app.middlewares.logging_middleware - INFO - Incoming request: GET /test/llm from 127.0.0.1
2024-12-17 21:32:30,153 - app.utils.permission_checker - INFO - Permission 'llm.chat' granted
2024-12-17 21:32:30,153 - app.middlewares.logging_middleware - INFO - Response: 200 GET /test/llm processed in 0.00s
2024-12-22 13:22:36,475 - TestApp - INFO - 程序启动
2024-12-22 13:22:36,475 - TestApp - WARNING - 注意：这只是一个警告
2024-12-22 13:22:36,475 - TestApp - ERROR - 错误：某些功能未能正常运行
2024-12-22 13:22:36,475 - TestApp - CRITICAL - 严重错误：程序即将崩溃
2024-12-28 15:47:51,412 - app.services.stt_service - ERROR - Error during recognition: HTTP request failed: Client error '400 Bad Request' for url 'https://nls-gateway-cn-shanghai.aliyuncs.com/stream/v1/asr?appkey=ha5OsDlffgxrJZ7c&format=pcm&sample_rate=16000'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400
Traceback (most recent call last):
  File "/home/wds/workspace/now/LLM_router/app/services/stt_engine/aliyun.py", line 75, in recognize
    response.raise_for_status() # 检查响应状态码
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_models.py", line 829, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '400 Bad Request' for url 'https://nls-gateway-cn-shanghai.aliyuncs.com/stream/v1/asr?appkey=ha5OsDlffgxrJZ7c&format=pcm&sample_rate=16000'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/wds/workspace/now/LLM_router/app/services/stt_service.py", line 53, in recognize
    result = await self._engine.recognize(audio_data, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/workspace/now/LLM_router/app/services/stt_engine/aliyun.py", line 79, in recognize
    raise RuntimeError(f"HTTP request failed: {str(e)}")
RuntimeError: HTTP request failed: Client error '400 Bad Request' for url 'https://nls-gateway-cn-shanghai.aliyuncs.com/stream/v1/asr?appkey=ha5OsDlffgxrJZ7c&format=pcm&sample_rate=16000'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400
2024-12-28 15:48:49,081 - app.services.stt_service - ERROR - Error during recognition: HTTP request failed: Client error '400 Bad Request' for url 'https://nls-gateway-cn-shanghai.aliyuncs.com/stream/v1/asr?appkey=ha5OsDlffgxrJZ7c&format=pcm&sample_rate=16000'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400
Traceback (most recent call last):
  File "/home/wds/workspace/now/LLM_router/app/services/stt_engine/aliyun.py", line 75, in recognize
    response.raise_for_status() # 检查响应状态码
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_models.py", line 829, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '400 Bad Request' for url 'https://nls-gateway-cn-shanghai.aliyuncs.com/stream/v1/asr?appkey=ha5OsDlffgxrJZ7c&format=pcm&sample_rate=16000'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/wds/workspace/now/LLM_router/app/services/stt_service.py", line 53, in recognize
    result = await self._engine.recognize(audio_data, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/workspace/now/LLM_router/app/services/stt_engine/aliyun.py", line 79, in recognize
    raise RuntimeError(f"HTTP request failed: {str(e)}")
RuntimeError: HTTP request failed: Client error '400 Bad Request' for url 'https://nls-gateway-cn-shanghai.aliyuncs.com/stream/v1/asr?appkey=ha5OsDlffgxrJZ7c&format=pcm&sample_rate=16000'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400
2024-12-28 15:48:49,082 - app.services.stt_service - ERROR - Error during recognition: HTTP request failed: 
Traceback (most recent call last):
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_transports/default.py", line 101, in map_httpcore_exceptions
    yield
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_transports/default.py", line 394, in handle_async_request
    resp = await self._pool.handle_async_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 256, in handle_async_request
    raise exc from None
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 236, in handle_async_request
    response = await connection.handle_async_request(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpcore/_async/connection.py", line 103, in handle_async_request
    return await self._connection.handle_async_request(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpcore/_async/http11.py", line 136, in handle_async_request
    raise exc
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpcore/_async/http11.py", line 106, in handle_async_request
    ) = await self._receive_response_headers(**kwargs)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpcore/_async/http11.py", line 177, in _receive_response_headers
    event = await self._receive_event(timeout=timeout)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpcore/_async/http11.py", line 217, in _receive_event
    data = await self._network_stream.read(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 32, in read
    with map_exceptions(exc_map):
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ReadError

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/wds/workspace/now/LLM_router/app/services/stt_engine/aliyun.py", line 70, in recognize
    response = await self._client.post(
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_client.py", line 1859, in post
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_transports/default.py", line 393, in handle_async_request
    with map_httpcore_exceptions():
         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_transports/default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ReadError

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/wds/workspace/now/LLM_router/app/services/stt_service.py", line 53, in recognize
    result = await self._engine.recognize(audio_data, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/workspace/now/LLM_router/app/services/stt_engine/aliyun.py", line 79, in recognize
    raise RuntimeError(f"HTTP request failed: {str(e)}")
RuntimeError: HTTP request failed: 
2024-12-28 15:52:34,087 - app.services.stt_service - ERROR - Error during recognition: HTTP request failed: Client error '400 Bad Request' for url 'https://nls-gateway-cn-shanghai.aliyuncs.com/stream/v1/asr?appkey=ha5OsDlffgxrJZ7c&format=pcm&sample_rate=16000'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400
Traceback (most recent call last):
  File "/home/wds/workspace/now/LLM_router/app/services/stt_engine/aliyun.py", line 75, in recognize
    response.raise_for_status() # 检查响应状态码
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_models.py", line 829, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '400 Bad Request' for url 'https://nls-gateway-cn-shanghai.aliyuncs.com/stream/v1/asr?appkey=ha5OsDlffgxrJZ7c&format=pcm&sample_rate=16000'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/wds/workspace/now/LLM_router/app/services/stt_service.py", line 53, in recognize
    result = await self._engine.recognize(audio_data, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/workspace/now/LLM_router/app/services/stt_engine/aliyun.py", line 79, in recognize
    raise RuntimeError(f"HTTP request failed: {str(e)}")
RuntimeError: HTTP request failed: Client error '400 Bad Request' for url 'https://nls-gateway-cn-shanghai.aliyuncs.com/stream/v1/asr?appkey=ha5OsDlffgxrJZ7c&format=pcm&sample_rate=16000'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400
2024-12-28 15:52:34,088 - app.services.stt_service - ERROR - Error during recognition: HTTP request failed: 
Traceback (most recent call last):
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_transports/default.py", line 101, in map_httpcore_exceptions
    yield
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_transports/default.py", line 394, in handle_async_request
    resp = await self._pool.handle_async_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 256, in handle_async_request
    raise exc from None
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 236, in handle_async_request
    response = await connection.handle_async_request(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpcore/_async/connection.py", line 103, in handle_async_request
    return await self._connection.handle_async_request(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpcore/_async/http11.py", line 136, in handle_async_request
    raise exc
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpcore/_async/http11.py", line 106, in handle_async_request
    ) = await self._receive_response_headers(**kwargs)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpcore/_async/http11.py", line 177, in _receive_response_headers
    event = await self._receive_event(timeout=timeout)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpcore/_async/http11.py", line 217, in _receive_event
    data = await self._network_stream.read(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 32, in read
    with map_exceptions(exc_map):
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ReadError

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/wds/workspace/now/LLM_router/app/services/stt_engine/aliyun.py", line 70, in recognize
    response = await self._client.post(
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_client.py", line 1859, in post
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_transports/default.py", line 393, in handle_async_request
    with map_httpcore_exceptions():
         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_transports/default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ReadError

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/wds/workspace/now/LLM_router/app/services/stt_service.py", line 53, in recognize
    result = await self._engine.recognize(audio_data, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/workspace/now/LLM_router/app/services/stt_engine/aliyun.py", line 79, in recognize
    raise RuntimeError(f"HTTP request failed: {str(e)}")
RuntimeError: HTTP request failed: 
2024-12-28 15:52:34,089 - app.services.stt_service - ERROR - Error during recognition: HTTP request failed: 
Traceback (most recent call last):
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_transports/default.py", line 101, in map_httpcore_exceptions
    yield
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_transports/default.py", line 394, in handle_async_request
    resp = await self._pool.handle_async_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 256, in handle_async_request
    raise exc from None
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 236, in handle_async_request
    response = await connection.handle_async_request(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpcore/_async/connection.py", line 103, in handle_async_request
    return await self._connection.handle_async_request(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpcore/_async/http11.py", line 136, in handle_async_request
    raise exc
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpcore/_async/http11.py", line 106, in handle_async_request
    ) = await self._receive_response_headers(**kwargs)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpcore/_async/http11.py", line 177, in _receive_response_headers
    event = await self._receive_event(timeout=timeout)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpcore/_async/http11.py", line 217, in _receive_event
    data = await self._network_stream.read(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 32, in read
    with map_exceptions(exc_map):
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ReadError

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/wds/workspace/now/LLM_router/app/services/stt_engine/aliyun.py", line 70, in recognize
    response = await self._client.post(
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_client.py", line 1859, in post
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_transports/default.py", line 393, in handle_async_request
    with map_httpcore_exceptions():
         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_transports/default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ReadError

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/wds/workspace/now/LLM_router/app/services/stt_service.py", line 53, in recognize
    result = await self._engine.recognize(audio_data, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/workspace/now/LLM_router/app/services/stt_engine/aliyun.py", line 79, in recognize
    raise RuntimeError(f"HTTP request failed: {str(e)}")
RuntimeError: HTTP request failed: 
2024-12-28 15:53:24,643 - app.services.stt_service - ERROR - Error during recognition: HTTP request failed: Client error '400 Bad Request' for url 'https://nls-gateway-cn-shanghai.aliyuncs.com/stream/v1/asr?appkey=ha5OsDlffgxrJZ7c&format=pcm&sample_rate=16000'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400
Traceback (most recent call last):
  File "/home/wds/workspace/now/LLM_router/app/services/stt_engine/aliyun.py", line 75, in recognize
    response.raise_for_status() # 检查响应状态码
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_models.py", line 829, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '400 Bad Request' for url 'https://nls-gateway-cn-shanghai.aliyuncs.com/stream/v1/asr?appkey=ha5OsDlffgxrJZ7c&format=pcm&sample_rate=16000'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/wds/workspace/now/LLM_router/app/services/stt_service.py", line 53, in recognize
    result = await self._engine.recognize(audio_data, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/workspace/now/LLM_router/app/services/stt_engine/aliyun.py", line 79, in recognize
    raise RuntimeError(f"HTTP request failed: {str(e)}")
RuntimeError: HTTP request failed: Client error '400 Bad Request' for url 'https://nls-gateway-cn-shanghai.aliyuncs.com/stream/v1/asr?appkey=ha5OsDlffgxrJZ7c&format=pcm&sample_rate=16000'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400
2024-12-28 15:53:24,644 - app.services.stt_service - ERROR - Error during recognition: HTTP request failed: 
Traceback (most recent call last):
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_transports/default.py", line 101, in map_httpcore_exceptions
    yield
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_transports/default.py", line 394, in handle_async_request
    resp = await self._pool.handle_async_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 256, in handle_async_request
    raise exc from None
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 236, in handle_async_request
    response = await connection.handle_async_request(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpcore/_async/connection.py", line 103, in handle_async_request
    return await self._connection.handle_async_request(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpcore/_async/http11.py", line 136, in handle_async_request
    raise exc
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpcore/_async/http11.py", line 106, in handle_async_request
    ) = await self._receive_response_headers(**kwargs)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpcore/_async/http11.py", line 177, in _receive_response_headers
    event = await self._receive_event(timeout=timeout)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpcore/_async/http11.py", line 217, in _receive_event
    data = await self._network_stream.read(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 32, in read
    with map_exceptions(exc_map):
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ReadError

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/wds/workspace/now/LLM_router/app/services/stt_engine/aliyun.py", line 70, in recognize
    response = await self._client.post(
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_client.py", line 1859, in post
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_transports/default.py", line 393, in handle_async_request
    with map_httpcore_exceptions():
         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_transports/default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ReadError

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/wds/workspace/now/LLM_router/app/services/stt_service.py", line 53, in recognize
    result = await self._engine.recognize(audio_data, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/workspace/now/LLM_router/app/services/stt_engine/aliyun.py", line 79, in recognize
    raise RuntimeError(f"HTTP request failed: {str(e)}")
RuntimeError: HTTP request failed: 
2024-12-28 15:53:24,645 - app.services.stt_service - ERROR - Error during recognition: HTTP request failed: 
Traceback (most recent call last):
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_transports/default.py", line 101, in map_httpcore_exceptions
    yield
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_transports/default.py", line 394, in handle_async_request
    resp = await self._pool.handle_async_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 256, in handle_async_request
    raise exc from None
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpcore/_async/connection_pool.py", line 236, in handle_async_request
    response = await connection.handle_async_request(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpcore/_async/connection.py", line 103, in handle_async_request
    return await self._connection.handle_async_request(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpcore/_async/http11.py", line 136, in handle_async_request
    raise exc
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpcore/_async/http11.py", line 106, in handle_async_request
    ) = await self._receive_response_headers(**kwargs)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpcore/_async/http11.py", line 177, in _receive_response_headers
    event = await self._receive_event(timeout=timeout)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpcore/_async/http11.py", line 217, in _receive_event
    data = await self._network_stream.read(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpcore/_backends/anyio.py", line 32, in read
    with map_exceptions(exc_map):
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.ReadError

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/wds/workspace/now/LLM_router/app/services/stt_engine/aliyun.py", line 70, in recognize
    response = await self._client.post(
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_client.py", line 1859, in post
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_transports/default.py", line 393, in handle_async_request
    with map_httpcore_exceptions():
         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/wds/miniconda3/envs/llm/lib/python3.12/site-packages/httpx/_transports/default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.ReadError

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/wds/workspace/now/LLM_router/app/services/stt_service.py", line 53, in recognize
    result = await self._engine.recognize(audio_data, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/wds/workspace/now/LLM_router/app/services/stt_engine/aliyun.py", line 79, in recognize
    raise RuntimeError(f"HTTP request failed: {str(e)}")
RuntimeError: HTTP request failed: 
